<ion-header [translucent]="true" class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button style="color: var(--med-teal);"></ion-menu-button>
    </ion-buttons>

    <ion-title>ROX & CO₂ Gap</ion-title>

    <ion-buttons slot="end" style="margin-right: 10px;">
      <div style="text-align: right; color: white;">
        <div style="font-weight: bold; font-size: 1em;">
          Bed {{ patient.selectedBedId || '?' }}
        </div>
        @if (patient.current.naam) {
          <div style="font-size: 0.7em; opacity: 0.8; margin-top: -2px;">
            {{ patient.current.naam }}
          </div>
        }
      </div>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">

  <ion-card class="co2-container">
    <div class="co2-header" style="display: flex; justify-content: space-between; align-items: center; padding-right: 8px;">
      <div style="display: flex; align-items: center;">
        <ion-icon name="cloud-outline" style="margin-right: 8px;"></ion-icon>
        <h3>CO₂ Gradiënt & Dode Ruimte</h3>
      </div>

      <ion-button fill="clear" size="small" (click)="toonCO2Info()" style="--color: #00796B; font-weight: bold;">
        Uitleg
        <ion-icon name="chevron-forward-outline" slot="end" style="color:teal;"></ion-icon>
      </ion-button>
    </div>

    <ion-card-content>
      <ion-grid class="ion-no-padding">
        <ion-row>
          <ion-col size="6">
            <ion-input
              class="custom-green-input"
              label="PaCO₂ (kPa)"
              label-placement="floating"
              fill="outline"
              type="number"
              inputmode="decimal"
              [(ngModel)]="paco2"
              (ionInput)="calculateCO2()">
            </ion-input>
          </ion-col>

          <ion-col size="6">
            <ion-input
              class="custom-green-input"
              label="EtCO₂ (kPa)"
              label-placement="floating"
              fill="outline"
              type="number"
              inputmode="decimal"
              [(ngModel)]="etCO2"
              (ionInput)="calculateCO2()">
            </ion-input>
          </ion-col>
        </ion-row>
      </ion-grid>

      @if (co2Gradient !== null) {
        <div class="co2-result-box">
          <div class="result-row">
            <span>P(a-et)CO₂ Gap:</span>
            <span class="value" [style.color]="gapColor">{{ co2Gradient }} kPa</span>
          </div>
          <div class="result-row">
            <span>Est. Vd/Vt (Dode Ruimte):</span>
            <span class="value" [style.color]="vdColor">{{ deadSpacePerc }}%</span>
          </div>
          <div class="score-advies">{{ co2Advies }}</div>
        </div>
      }
    </ion-card-content>
  </ion-card>

  <ion-card class="rox-container">
    <div class="rox-header" style="display: flex; justify-content: space-between; align-items: center; padding-right: 8px;">
      <div style="display: flex; align-items: center;">
        <ion-icon name="calculator-outline" style="margin-right: 8px;"></ion-icon>
        <h3>ROX Index (HFNO)</h3>
      </div>

      <ion-button fill="clear" size="small" (click)="toonRoxInfo()" style="--color: #00796B; font-weight: bold;">
        Uitleg
        <ion-icon name="chevron-forward-outline" slot="end" style="color:teal;"></ion-icon>
      </ion-button>
    </div>

    <ion-card-content>
      <ion-grid class="ion-no-padding">
        <ion-row>
          <ion-col size="4">
            <ion-input class="custom-green-input" label="SpO₂ (%)" label-placement="floating" fill="outline"
              type="number" inputmode="decimal" [(ngModel)]="sao2" (ionInput)="calculateROX()">
            </ion-input>
          </ion-col>

          <ion-col size="4">
            <ion-input class="custom-green-input" label="FiO₂ (%)" label-placement="floating" fill="outline"
              type="number" inputmode="decimal" [(ngModel)]="fio2" (ionInput)="calculateROX()">
            </ion-input>
          </ion-col>

          <ion-col size="4">
            <ion-input class="custom-green-input" label="RR (/min)" label-placement="floating" fill="outline"
              type="number" inputmode="decimal" [(ngModel)]="rr" (ionInput)="calculateROX()">
            </ion-input>
          </ion-col>
        </ion-row>
      </ion-grid>

      @if (roxScore !== null) {
        <div class="rox-result-box">
          <div class="score-label">ROX Score</div>
          <div class="score-value" [style.color]="roxColor">{{ roxScore }}</div>
          <div class="score-advies">{{ roxAdvies }}</div>
        </div>
      }
    </ion-card-content>
  </ion-card>

  <div style="height: 50px;"></div>

</ion-content>
